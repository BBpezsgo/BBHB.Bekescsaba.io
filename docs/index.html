<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="./button.css">
    <link rel="stylesheet" href="./castle-list.css">
    <link rel="stylesheet" href="./castle-info.css">
    <link rel="stylesheet" href="./container.css">
    <link rel="stylesheet" href="./global.css">
    <link rel="stylesheet" href="./background.css">

    <style>
        #debug {
            background-color: #222;
            color: #ddd;
            padding: 5px;
            border-radius: 5px;
            width: fit-content;
        }

        body {
            overflow-x: hidden;
            margin: 0;
        }

        .map-frame {
            width: calc(100% - 30px);
            height: 400px;
            margin: 10px;
            box-shadow: #000a 3px 3px 3px;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div id="castle-info" style="display: none;">
            <div class="close-btn" onclick="document.getElementById('castle-info').style.display = 'none'">
                <img src="./images/x.png">
            </div>

            <h1>KASTÉLY NEVE</h1>
    
            <img src="https://i.pinimg.com/originals/41/a2/a5/41a2a560f6af4ea3e04b487ad9710e2c.jpg">

            <p>
                Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse venenatis justo id sem commodo finibus. Donec eu felis ac velit rutrum efficitur in et odio. Curabitur id leo suscipit turpis volutpat ultrices. Vivamus sit amet lacus purus. Cras tincidunt pulvinar nisl. Vestibulum hendrerit ligula libero, ut feugiat velit eleifend nec. Proin quam dui, consectetur ut orci quis, porttitor porta ante. Maecenas ac lobortis nibh. Maecenas et leo a sapien placerat viverra nec id velit. Sed in dolor egestas, porta ex quis, hendrerit lacus. In hac habitasse platea dictumst. Aenean ac pharetra lacus. Maecenas ac porttitor risus.
            </p>
        </div>

        <h1>Békés-megye Kastélyai</h1>

        <iframe src="./map-iframe.html" class="map-frame"></iframe>
    
        <div id="debug-panel">
            <p id="debug">
    
            </p>
        </div>

        <div id="castle-list">

        </div>
    
        <script>
            const castleInfo = document.getElementById('castle-info')
            const mapIframe = document.getElementsByTagName('iframe')[0]
            const castleList = document.getElementById('castle-list')
    
            var markers = []
            fetch('./jsons/map-markers.json')
            .then((response) => {
                response.json()
                .then((json) => {
                    markers = json.markers
                    const oldElements = castleList.getElementsByTagName('div')
                    while (oldElements.length > 0) {
                        oldElements[0].parentNode.removeChild(oldElements[0])
                    }
                    for (let i = 0; i < markers.length; i++) {
                        const castle = markers[i].data
                        const newElement = document.createElement('div')
                        newElement.addEventListener('click', (e) => { ShowCastleInfo(i) })

                        const bg = document.createElement('div')
                        bg.style.backgroundImage = `url('${castle.image}')`
                        bg.className = 'bg'
                        newElement.appendChild(bg)

                        const content = document.createElement('div')
                        content.className = 'content'
                        content.addEventListener('click', (e) => { ShowCastleInfo(i) })
                        newElement.appendChild(content)

                        const title = document.createElement('h1')
                        title.innerText = castle.name
                        title.addEventListener('click', (e) => { ShowCastleInfo(i) })
                        content.appendChild(title)

                        castleList.appendChild(newElement)
                    }
                })
            })
    
            window.OnMarkerClicked = (e) => {
                ShowCastleInfo(e.substring(11))
            }

            const ShowCastleInfo = (i) => {
                /** @type {{
                 *  name: string,
                 *  description: string[]
                 * }} */
                const castle = markers[i].data
                castleInfo.style.display = 'block'
                castleInfo.getElementsByTagName('h1')[0].innerText = castle.name
                castleInfo.getElementsByTagName('img')[1].src = castle.image
                const descs = castleInfo.getElementsByTagName('p')
                while (descs.length > 0) {
                    descs[0].parentNode.removeChild(descs[0])
                }
                for (let i = 0; i < castle.description.length; i++) {
                    const desc = castle.description[i]
                    const newNode = document.createElement('p')
                    newNode.innerText = desc
                    castleInfo.appendChild(newNode)
                }
            }
        </script>
    </div>

    <div class="container">
        <a class="button" href="./quiz.html">Quiz! Teszteld tudásod!</a>
    </div>

    <div class="mt-5 p-4 bg-dark text-white text-center">
        <p>© Copyright 2022</p>
    </div>

    <style id="bgStyle">body::before {background-image:url('./images/sky-low.jpg')}</style>
    <script src="./scripts/background.js"></script>
</body>

</html>